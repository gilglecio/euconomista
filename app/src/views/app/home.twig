{% extends 'app/base.twig' %}

{% block pageTitle title %}

{% block app %}
    
    <script type="text/javascript" src="/assets/chart.js/dist/Chart.min.js"></script>
    <div class="row">
        <div class="col-xs-12 jumbotron">
            <canvas id="releases" width="100" height="30"></canvas>
        </div>
        <div class="col-xs-12 jumbotron">
        <canvas id="categories" width="100" height="30"></canvas>
        </div>
    </div>

    <script>

    Chart.defaults.global.legend.display = false;

    /**
     * Number.prototype.format(n, x, s, c)
     * 
     * @param integer n: length of decimal
     * @param integer x: length of whole part
     * @param mixed   s: sections delimiter
     * @param mixed   c: decimal delimiter
     */
    Number.prototype.format = function(n, x, s, c) {
        var re = '\\d(?=(\\d{' + (x || 3) + '})+' + (n > 0 ? '\\D' : '$') + ')',
            num = this.toFixed(Math.max(0, ~~n));

        return (c ? num.replace('.', c) : num).replace(new RegExp(re, 'g'), '$&' + (s || ','));
    };

    Chart.Line('releases', {
        options: {
            title: {
                display: true,
                text: 'Receitas X Despesas'
            },
            scales: {
                yAxes: [{
                    ticks: {
                        callback: function(value, index, values) {
                            return 'R$ ' + value.format(2, 3, '', ',');
                        }
                    }
                }]
            }
        },
        data: {
            labels: ['Set/2016', 'Out/2016', 'Nov/2016', 'Dez/2016', 'Jan/2017', 'Fev/2017', 'Mar/2017'],
            datasets: {{ chart.releases|raw }}
        },
    })

    Chart.Line('categories', {
        options: {
            title: {
                display: true,
                text: 'Categorias'
            },
            scales: {
                yAxes: [{
                    ticks: {
                        callback: function(value, index, values) {
                            return 'R$ ' + value.format(2, 3, '', ',');
                        }
                    }
                }]
            }
        },
        data: {{ chart.categories|raw }},
    })
    </script>
{% endblock %}